<!DOCTYPE html>
<html lang="ko">
<head>
	<title>Bootstrap Example</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
</head>
<body>
<div class="container">
	<div class="page-header">
		<h1>지역별 대기 정보</h1>
	</div>
	
	<div class="row">
		<div class="col-sm-12 text-right">
			<form class="form-inline">
				<label>지역 : </label>
				<select id="city" class="form-control">
					<option value=""> 지역을 선택하세요</option>
					<option value="서울"> 서울</option>
					<option value="부산"> 부산</option>
					<option value="대구"> 대구</option>
					<option value="인천"> 인천</option>
					<option value="광주"> 광주</option>
					<option value="대전"> 대전</option>
					<option value="울산"> 울산</option>
					<option value="경기"> 경기</option>
					<option value="강원"> 강원</option>
					<option value="충북"> 충북</option>
					<option value="충남"> 충남</option>
					<option value="전북"> 전북</option>
					<option value="전남"> 전남</option>
					<option value="경북"> 경북</option>
					<option value="경남"> 경남</option>
					<option value="제주"> 제주</option>
					<option value="세종"> 세종</option>
				</select>
			</form>
		</div>
	</div>
	
	<table class="table" id="air-table">
		<thead>
			<tr>
				<th>측정소명</th>
				<th>통합대기환경지수</th>
				<th>통합대기환경수치</th>
				<th>미세먼지 농도</th>
				<th>초미세먼지 농도</th>
				<th>오존 농도</th>
			</tr>
		</thead>
		<tbody></tbody>
	</table>
</div>

<script type="text/javascript">
	$('#city').change(function(event) {
		var city = $(this).val();
		if(!city) {
			alert('지역명을 선택하세요');
			return;
		}
		
		$.get('http://192.168.10.254:81/jquery-app/air', {city:city}, function(xmlDoc) {
			
			$('#air-table tbody').empty();
			
			$(xmlDoc).find('item').each(function(index, el) {
				var stationName = $(el).find('stationName').text();
				var o3Value = $(el).find('o3Value').text();
				var pm10Value = $(el).find('pm10Value').text();
				var pm25Value = $(el).find('pm25Value').text();
				var khaiValue = $(el).find('khaiValue').text();
				var khaiGrade = $(el).find('khaiGrade').text();
				
				var khaiGradeMessage = "-";
				if(khaiGrade == '1') {
					khaiGradeMessage = '좋음';
				} else if(khaiGrade == '2') {
					khaiGradeMessage = '보통';
				} else if(khaiGrade == '3') {
					khaiGradeMessage = '나쁨';
				} else if(khaiGrade == '4') {
					khaiGradeMessage = '매우나쁨';
				}
				
				var row = '<tr>';
				row += '<td>'+stationName+'</td>';
				row += '<td>'+khaiGrade+' ('+khaiGradeMessage+')</td>';
				row += '<td>'+khaiValue+'</td>';
				row += '<td>'+pm10Value+'</td>';
				row += '<td>'+pm25Value+'</td>';
				row += '<td>'+o3Value+'</td>';
				row += '</tr>';
				
				$('#air-table tbody').append(row);
			});
		});
	});
</script>
</body>
</html>