<!DOCTYPE html>
<html lang="ko">
<head>
	<title>Bootstrap Example</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
	<style type="text/css">
		#image-box {
			z-index: 10;
			position: absolute;
			top: 280px;
			left: 600px;
			display: none;
		}
		#boxoffice-table {
			position: relative;
			top: 10px;
		}
	</style>
</head>
<body>
<div class="container">
	<div class="page-header">
		<h1>박스 오피스 조회</h1>
	</div>
	
	<div class="well text-right">
		<form class="form-inline">
			<div class="form-group">
				<label>조회날짜 : </label>
				<input type="date" class="form-control" id="search-date">
				<button type="button" class="btn btn-primary">조회</button>
			</div>
		</form>
	</div>
	
	<div class="text-center" id="image-box">
		<img alt="로딩이미지" src="../images/loading.gif">
	</div>
	
	<table class="table" id="boxoffice-table">
		<thead>
			<tr>
				<th>순위</th>
				<th>제목</th>
				<th>개봉일</th>
				<th>점유율</th>
				<th>당일 관객수</th>
				<th>누적 관객수</th>
			</tr>
		</thead>
		<tbody></tbody>
	</table>
</div>
<script type="text/javascript">
	$('button').click(function(event) {
		
		var searchDate = $("#search-date").val().replace(/-/g, '');
		if(searchDate == '') {
			alert('조회날짜를 선택하세요');
			return;
		}
		
		$.ajax({
			type: "GET",
			url: "http://www.kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.json",
			data: {key:'430156241533f1d058c603178cc3ca0e', targetDt:searchDate},
			dataType: "json",
			beforeSend: function() {
				$('#boxoffice-table tbody').empty();
				$('#image-box').show();	// ajax 요청직전에 로딩이미지 표시
			},
			complete: function() {
				$('#image-box').hide(); // ajax 요청이 완료되면 로딩 이미지 감추기
			},
			success: function(result) {
				var items = result.boxOfficeResult.dailyBoxOfficeList;
				
				$.each(items, function(idex, item) {
					var row = '<tr>';
					row += '<td>'+item.rank+'</td>';
					row += '<td>'+item.movieNm+'</td>';
					row += '<td>'+item.openDt+'</td>';
					row += '<td>'+item.salesShare+'</td>';
					row += '<td>'+item.audiCnt+'</td>';
					row += '<td>'+item.audiAcc+'</td>';
					row += '</tr>';
					
					$('#boxoffice-table tbody').append(row);
				});
			},
			error: function() {
				alert('요청 처리중 에러가 발생하였습니다.');
			}
		});
	});
</script>
</body>
</html>